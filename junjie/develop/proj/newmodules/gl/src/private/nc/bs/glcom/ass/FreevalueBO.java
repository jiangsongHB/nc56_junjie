/***************************************************************\
 *     The skeleton of this class is generated by an automatic *
 * code generator for NC product.                              *
 \***************************************************************/

package nc.bs.glcom.ass;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Hashtable;
import java.util.List;
import java.util.Vector;

import javax.naming.NamingException;

import nc.bs.bd.pub.BDOperateContextObject;
import nc.bs.bd.pub.IBDBaseDoc;
import nc.bs.bd.pub.IBDOperateContextObject;
import nc.bs.dao.BaseDAO;
import nc.bs.dao.DAOException;
import nc.bs.gl.accbook.AssFreevalueBO;
import nc.bs.glcom.balance.PubDAO;
import nc.bs.logging.Log;
import nc.bs.pub.SystemException;
import nc.fi.fip.pub.IUFTypesInitializationValue;
import nc.impl.gl.accbook.GlAssDetailImpl;
import nc.itf.fi.pub.BDInfo;
import nc.itf.fi.pub.KeyLock;
import nc.jdbc.framework.processor.ResultSetProcessor;
import nc.vo.bd.access.AccessorManager;
import nc.vo.bd.access.BddataVO;
import nc.vo.bd.access.BdinfoManager;
import nc.vo.bd.access.BdinfoVO;
import nc.vo.bd.access.IBDAccessor;
import nc.vo.bd.b09.CumandocVO;
import nc.vo.bd.b09.CustManVO;
import nc.vo.bd.invdoc.InvmandocVO;
import nc.vo.bd.service.IBDOperate;
import nc.vo.dap.inteface.VoucherConvert;
import nc.vo.gl.assattriquerybalance.AssAttributeVOGetter;
import nc.vo.gl.pubvoucher.FreevalueVO;
import nc.vo.glcom.ass.AssVO;
import nc.vo.glcom.ass.BigAssMD5Util;
import nc.vo.glcom.balance.GlAssVO;
import nc.vo.glcom.exception.GLBusinessException;
import nc.vo.glcom.tools.GLPubProxy;
import nc.vo.pub.BusinessException;
import nc.vo.sm.nodepower.OrgnizeTypeVO;
import nc.vo.trade.bdinfo.BdinfoUtil;

public class FreevalueBO implements nc.vo.bd.service.IBDOperate {
	/**
	 * FreevalueBO 构造子注解。
	 */
	public FreevalueBO() {
		super();
	}

	private static final Log log = Log.getInstance(FreevalueBO.class);

	/**
	 * 是否属于常用辅助核算查询
	 * 
	 * @param vo
	 * @throws BusinessException 
	 */
	private boolean isCommonQuery(AssVO[] assvos) throws BusinessException {
		boolean isFromAssDetail = true;
		// 传入类型不在横表范围内
		if (assvos == null || assvos.length == 0) {
			return false;
		}
		for (int i = 0; i < assvos.length; i++) {
			if (AssFreevalueBO.getCommAssMapCache() != null && !AssFreevalueBO.getCommAssMapCache().containsKey(assvos[i].m_pk_checktype)) {
				//如果没有的话则看看是否到20个
				if (AssFreevalueBO.getCommAssMapCache().size() == AssFreevalueBO.ASSNUM) {
					isFromAssDetail = false;
					break;
				} else {
					AssFreevalueBO ab = new AssFreevalueBO();
					ab.insertCommAssMap(new AssVO[]{assvos[i]});
				}
			}
		}
		return isFromAssDetail;
	}
	
	public String getAssID_RequiresNew(AssVO[] assvos, Boolean blnInsert,String smd5) throws GLBusinessException {
		//KeyLock lock = new KeyLock();
		//boolean bLockSuccess = false;
		BigFreevalueBO bigbo=new BigFreevalueBO();
		try {
			if (assvos == null || assvos.length == 0)
				return new String("");
			FreevalueDMO freevalueDMO = new FreevalueDMO();
			assvos = getRealAssVO(assvos);
			String intID = "";
			//现在查询单一ID是统一从gl_bigfreevalue表里去取 modify By liyongru For V56 at 20091030
		    if(null!=smd5 && smd5.trim().length()>0){
		    	intID=bigbo.getID(smd5);
		    }else{
		    	intID=bigbo.getID(assvos);
		    }
			
			if (intID != null && !intID.equals(""))
				return new String(intID); // 如果该组合的ID号已经存在则直接取得该ID
			else {
				if (!blnInsert.booleanValue())
					return intID;

				// 如果该组合的ID号不存在，在生成该ID号 
			
				int intCount = assvos.length;

				// ** 取得辅助核算主键 */
				String assID = freevalueDMO.getAssOID();
				FreevalueVO[] freevalues = buildFreevalueVOSByAssVOS(assvos,
						intCount, assID);
				String tmpID=bigbo.insert(assID, freevalues,freevalueDMO);
				if(null!=tmpID && tmpID.trim().length()>0){
					return tmpID;
				}
		
				
				return assID;
			}
		} catch (Exception e) {
			log.error(e);
			throw new GLBusinessException("FreevalueBO::getAssID_RequiresNew() Exception!"+e.getMessage(), e);
		} finally {
			/*if (bLockSuccess)
				try {
					lock.freeKey("ncglass0000000000000", nc.bs.ml.NCLangResOnserver.getInstance().getStrByID("2002033381", "UPP2002033381-000005")
																																					 * @res
																																					 * "辅助"
																																					 , "gl_freevalue");
				} catch (BusinessException ex) {
					log.error(ex);
				}*/

		}
	}

	
	public String getAssID_RequiresNew(AssVO[] assvos, Boolean blnInsert) throws GLBusinessException {
		//KeyLock lock = new KeyLock();
		//boolean bLockSuccess = false;
		BigFreevalueBO bigbo=new BigFreevalueBO();
		try {
			if (assvos == null || assvos.length == 0)
				return new String("");
			FreevalueDMO freevalueDMO = new FreevalueDMO();
			assvos = getRealAssVO(assvos);
			String intID = "";
			//现在查询单一ID是统一从gl_bigfreevalue表里去取 modify By liyongru For V56 at 20091030
			intID=bigbo.getID(assvos);
			if (intID != null && !intID.equals(""))
				return new String(intID); // 如果该组合的ID号已经存在则直接取得该ID
			else {
				if (!blnInsert.booleanValue())
					return intID;

				// 如果该组合的ID号不存在，在生成该ID号 
			
				int intCount = assvos.length;

				// ** 取得辅助核算主键 */
				String assID = freevalueDMO.getAssOID();
				FreevalueVO[] freevalues = buildFreevalueVOSByAssVOS(assvos,
						intCount, assID);
				String tmpID=bigbo.insert(assID, freevalues,freevalueDMO);
				if(null!=tmpID && tmpID.trim().length()>0){
					return tmpID;
				}
			/*	for (int i = 0; i < 5; i++) {
					bLockSuccess = lock.lockKey("ncglass0000000000000", nc.bs.ml.NCLangResOnserver.getInstance().getStrByID("2002033381", "UPP2002033381-000005")
																																									 * @res
																																									 * "辅助"
																																									 , "gl_freevalue");
					if (bLockSuccess)
						break;
					try {
						Thread.sleep(100);
					} catch (Exception e) {
					}
				}
				if (!bLockSuccess)
					throw new GLBusinessException(nc.bs.ml.NCLangResOnserver.getInstance().getStrByID("2002033381", "UPP2002033381-000006")
																																			 * @res
																																			 * "有其他用户在操作辅助项，请稍候再试。"
																																			 );
*/
				
				return assID;
			}
		} catch (Exception e) {
			log.error(e);
			throw new GLBusinessException("FreevalueBO::getAssID_RequiresNew() Exception!"+e.getMessage(), e);
		} finally {
			/*if (bLockSuccess)
				try {
					lock.freeKey("ncglass0000000000000", nc.bs.ml.NCLangResOnserver.getInstance().getStrByID("2002033381", "UPP2002033381-000005")
																																					 * @res
																																					 * "辅助"
																																					 , "gl_freevalue");
				} catch (BusinessException ex) {
					log.error(ex);
				}*/

		}
	}

	private FreevalueVO[] buildFreevalueVOSByAssVOS(AssVO[] assvos,
			int intCount, String assID) throws GLBusinessException {
		FreevalueVO[] freevalues = new FreevalueVO[assvos.length];
		HashMap typeMap = new HashMap();
		for (int i = 0; i < intCount; i++) {
			freevalues[i] = new FreevalueVO();
			// ** 设置辅助核算主键 */
			freevalues[i].setFreevalueid(assID);
			Object value = typeMap.get(assvos[i].getPk_Checktype());
			if (value != null && value.toString().equals(assvos[i].getPk_Checktype())) {
				throw new GLBusinessException(nc.bs.ml.NCLangResOnserver.getInstance().getStrByID("2002033381", "UPP2002033381-000003")/*
																																		 * @res
																																		 * "辅助核算组合不能有重复的核算类型：类型<"
																																		 */+ value + nc.bs.ml.NCLangResOnserver.getInstance().getStrByID("2002033381", "UPP2002033381-000004")/*
																														 * @res
																														 * ">重复!"
																														 */);
			}
			typeMap.put(assvos[i].getPk_Checktype(), assvos[i].getPk_Checktype());
			freevalues[i].setChecktype(assvos[i].getPk_Checktype());
			freevalues[i].setCheckvalue(assvos[i].getPk_Checkvalue());
			if (assvos[i].getCheckvaluecode() == null || assvos[i].getCheckvaluename() == null || assvos[i].getCheckvaluecode().trim().length() == 0
					|| assvos[i].getCheckvaluename().trim().length() == 0) {
				String[] strTemp = getCodeNameByValuePk(assvos[i].getPk_Checktype(), assvos[i].getPk_Checkvalue());
				freevalues[i].setValuecode(strTemp[0]);
				freevalues[i].setValuename(strTemp[1]);
			} else {
				freevalues[i].setValuecode(assvos[i].getCheckvaluecode());
				freevalues[i].setValuename(assvos[i].getCheckvaluename());
			}
			freevalues[i].setCheckcount(new Integer(intCount));
		}
		return freevalues;
	}
	
	//
	// 给定一个辅助核算组合，获取相应的ID
	// assvos:辅助核算组合
	// blnInsert:如果该组合在数据库中不存在，是否在数据库中保存
	//
	public String getAssID(AssVO[] assvos, Boolean blnInsert) throws GLBusinessException {
		String result="";
		try {
			String smd5=new BigAssMD5Util().getMD5ByAssvos(assvos);
			String assid=BigFreevalueMD5DataCache.getInstance().get(smd5);
			if(null==assid || assid.trim().length()==0){
				result=GLPubProxy.getRemoteFreevaluePub().getAssID_RequiresNew(assvos, blnInsert,smd5);
				BigFreevalueMD5DataCache.getInstance().put(smd5, result);
			}else{
				result=assid;
			}
		} catch (BusinessException e) {
			// TODO Auto-generated catch block
			nc.bs.logging.Logger.error("FreevalueBO::getAssID() Exception ！ "+e.getMessage());
			e.printStackTrace();
			throw new GLBusinessException(e);
		}
		return result;
	}
	
	public String getAssID(AssVO[] assvos, Boolean blnInsert,String smd5) throws GLBusinessException {
		String result="";
		try {
			
			String assid=BigFreevalueMD5DataCache.getInstance().get(smd5);
			if(null==assid || assid.trim().length()==0){
				result=GLPubProxy.getRemoteFreevaluePub().getAssID_RequiresNew(assvos, blnInsert,smd5);
				BigFreevalueMD5DataCache.getInstance().put(smd5, result);
			}else{
				result=assid;
			}
			
		} catch (BusinessException e) {
			// TODO Auto-generated catch block
			nc.bs.logging.Logger.error("FreevalueBO::getAssID() Exception ！ "+e.getMessage());
			e.printStackTrace();
			throw new GLBusinessException(e);
		}
		return result;
	}

	//
	// 给定一个辅助核算组合，包含该组合的所有ID
	// assvos:辅助核算组合
	//
	public String[] getAssIDs(AssVO[] assvos) throws GLBusinessException {
		try {
			FreevalueDMO freevalueDMO = new FreevalueDMO();
			return freevalueDMO.getIDs(assvos);
		} catch (Exception e) {
			log.error(e);
			throw new GLBusinessException("FreevalueBean::findByPrimaryKey(FreevaluePK) Exception!", e);
		}
	}

	public String[] getAssIDsbyCorp(AssVO[] assvos, String pk_corp) throws GLBusinessException {
		try {
			FreevalueDMO freevalueDMO = new FreevalueDMO();
			return freevalueDMO.getIDsbycorp(assvos, pk_corp);
		} catch (Exception e) {
			log.error(e);
			throw new GLBusinessException("FreevalueBean::findByPrimaryKey(FreevaluePK) Exception!", e);
		}
	}

	//
	// 给定一个辅助核算组合，获取相应的ID
	// assvos:辅助核算组合
	// blnInsert:如果该组合在数据库中不存在，是否在数据库中保存
	//
	public String[] getAssSigleIDs(ArrayList aryAssVOs) throws GLBusinessException {
		if (aryAssVOs == null || aryAssVOs.size() == 0)
			return null;
		String[] retIDs = new String[aryAssVOs.size()];
		try {

			Boolean bl = new Boolean(true);
			for (int i = 0; i < aryAssVOs.size(); i++) {
				if (aryAssVOs.get(i) != null && ((AssVO[]) aryAssVOs.get(i)).length > 0) {

					String id = null;
					id = getAssID((AssVO[]) aryAssVOs.get(i), bl);
					retIDs[i] = id;

				}

			}
		} catch (Exception e) {
			log.error(e);
			throw new GLBusinessException("FreevalueBean::getAssSigleIDs(ArrayList) Exception!", e);
		}
		return retIDs;
	}

	/**
	 * 根据valuecode获得pk_value。 创建日期：(01-10-16 15:58:26)
	 *
	 * @return java.lang.String
	 */
	public String[] getCodeNameByValuePk(String pk_bdinfo, String pk_value) throws GLBusinessException {

		if (pk_bdinfo != null && pk_value == null)
			return new String[] { null, null };
		nc.vo.bd.b02.BdinfoVO info = null;
		String[] retCodeName = new String[2];
		BdinfoUtil util = new BdinfoUtil();
		try {
			log.info("辅助核算类型PK:" + pk_bdinfo);
			// 客商、供应商
			if (pk_bdinfo.equals("00010000000000000048") // 供应商档案
					|| pk_bdinfo.equals("00010000000000000032") // 客商档案
					|| pk_bdinfo.equals("00010000000000000003") // 客户档案
			) {
				throw new GLBusinessException(nc.vo.ml.NCLangRes4VoTransl.getNCLangRes().getStrByID("2002gl55","UPP2002gl55-000667")/*@res "总账系统不允许客商管理档案，供应商管理档案，客户管理档案作为辅助核算"*/);
				// throw new
				// GLBusinessException(nc.bs.ml.NCLangResOnserver.getInstance().getStrByID("2002033381","UPP2002033381-000002")/*@res
				// "BD_INFO表里的信息不全!"*/);
			} else if (pk_bdinfo.equals("00010000000000000071") // 客户辅助核算
					|| pk_bdinfo.equals("00010000000000000072") // 供应商辅助核算
					|| pk_bdinfo.equals("00010000000000000073") // 客商辅助核算
					|| pk_bdinfo.equals("UAP00000000000invass")
					|| pk_bdinfo.equals("00010000000000000014")
					|| pk_bdinfo.equals("UAP00000000000jobass")
			) {

				IBDBaseDoc doc = util.getBDBaseDoc(pk_bdinfo, pk_value);
				if (doc != null) {
					retCodeName[1] = doc.getName();
					log.info("name:" + retCodeName[1]);
					retCodeName[0] = doc.getCode();
					log.info("code:" + retCodeName[0]);
				}
				return retCodeName;

			} else {
				int k = 1;
				log.info(k++);
				BDInfo bdinfoDMO = new BDInfo();
				info = bdinfoDMO.findSubjBdinfoVOByPrimaryKey(pk_bdinfo);
				if (info == null) {
					getRealBdInfo(pk_bdinfo);
				}
				if (info.getBdcode().startsWith("J")) {
					IBDBaseDoc doc = util.getBDBaseDoc(pk_bdinfo, pk_value);
					if (doc != null) {
						retCodeName[1] = doc.getName();
						log.info("name:" + retCodeName[1]);
						retCodeName[0] = doc.getCode();
						log.info("code:" + retCodeName[0]);
					}
					return retCodeName;
				} else if (info.getBdcode().startsWith("D")) {
					nc.bs.bd.def.DefdocBO docBO = new nc.bs.bd.def.DefdocBO();
					String[] pkCodeName = null;// defBO.querypk(info.getPk_defdef(),pk_value);
					nc.vo.bd.def.DefdocVO vo = docBO.findByPrimaryKey(pk_value);
					if (vo == null)
						return new String[] { null, null };
					pkCodeName = new String[3];
					pkCodeName[0] = pk_value;
					pkCodeName[1] = vo.getDoccode();
					pkCodeName[2] = vo.getDocname();
					if (pkCodeName != null)
						return new String[] { pkCodeName[1], pkCodeName[2] };
					else
						return new String[] { pk_value, pk_value };
				} else {
					log.info(k++);
					if (info != null) {
						String[] result = null;
						String tableName = info.getTablename();
						String pkField = info.getTablepkname();
						String codeField = info.getCodefieldname();
						String nameField = info.getNamefieldname();
						String corpField = info.getCorpfieldname();

						if (tableName == null || pkField == null || codeField == null || nameField == null)
							throw new GLBusinessException(nc.bs.ml.NCLangResOnserver.getInstance().getStrByID("2002033381", "UPP2002033381-000002")/*
																																					 * @res
																																					 * "BD_INFO表里的信息不全!"
																																					 */);

						log.info(k++);
						FreevalueDMO freevalueDMO = new FreevalueDMO();
						result = freevalueDMO.getValueCodeNameByPk(tableName, pkField, codeField, nameField, pk_value);
						return result;
					}
				}
			}
		} catch (Exception e) {
			throw new GLBusinessException(e.getMessage(), e);
		}
		return null;
	}

	/**
	 * \n创建日期：(2002-9-6 13:43:42)
	 *
	 * @return nc.vo.glcom.ass.AssVO[]
	 * @param vos
	 *            nc.vo.glcom.ass.AssVO[]
	 * @param pk_corp
	 *            java.lang.String
	 */
	private AssVO[] getCorpSpeciallizedAssVO(AssVO[] vos, String pk_corp) throws GLBusinessException {
		if (vos == null || vos.length == 0)
			return null;
		for (int i = 0; i < vos.length; i++) {
			String typePk = vos[i].getPk_Checktype();
			String valueCode = vos[i].getCheckvaluecode();
			String valuePk = getValuePkByValueCodeNew(typePk, pk_corp, valueCode);
			if(valuePk == null)
				return null;
			vos[i].setPk_Checkvalue(valuePk); 
			/** 若档案名称不变，可不执行下面语句 */
			// String[] codeName = getCodeNameByValuePk(typePk,valuePk);
			// vos[i].setCheckvaluename(codeName[1]);
		}
		return vos;
	}

	/**
	 * \n创建日期：(2002-9-6 13:49:12)
	 *
	 * @return java.lang.Integer
	 * @param id
	 *            java.lang.Integer
	 *            ######################################################################
	 *            功能：根据一个辅助核算组合ID，得到另一个公司同一个组合相对应的组合ID
	 *            原则：辅助核算类型不变，核算值的编码不变，根据编码得到该公司所对应档案的主键 参数说明： pk_corp ―要转换的公司主键
	 *            id ―要转换的辅助核算组合ID
	 *            ######################################################################
	 */
	public String getCorpSpeciallizedID(String pk_corp, String id) throws GLBusinessException {
		nc.vo.glcom.ass.AssVO[] assvos1 = queryAll(id);
		nc.vo.glcom.ass.AssVO[] assvos2 = getCorpSpeciallizedAssVO(assvos1, pk_corp);
		return getAssID(assvos2, new Boolean(true));
	}

	private String getCustSuppPk(String basTable, String mngTable, String basPkField, String mngPkField, String codeFiled, String valueCode, String pk_corp, boolean blnCustomer) throws Exception {
		// get BasPk From basTable by valuecode and pk_corp
		String sql1 = "select " + basPkField + " from " + basTable + " where " + codeFiled + "='" + valueCode + "' and (pk_corp='0001' or pk_corp='" + pk_corp + "') order by pk_corp desc";
		ArrayList res1 = (ArrayList) new PubDAO().queryVOsBySql(null, null, sql1);
		String pk_bas = null;
		if (res1 != null && res1.size() > 0) {
			pk_bas = String.valueOf(((Object[]) res1.get(0))[0]);
			// (String)((ArrayList)res1[0]).getStrFields()[0];
		} else {
			return null;
		}

		// get MngPk From nngTable by BasPk and pk_corp
		String sql2 = "select " + mngPkField + " from " + mngTable + " where " + basPkField + "='" + pk_bas + "' and pk_corp='" + pk_corp + "'";
		if (blnCustomer)
			sql2 = sql2 + " and custflag<>'1' and custflag<>'3' "; // 客户
		else
			sql2 = sql2 + " and (custflag='1' or custflag='3') ";// 供应商
		ArrayList res2 = (ArrayList) new PubDAO().queryVOsBySql(null, null, sql2);

		String pk_mng = null;
		if (res2 != null && res2.size() > 0) {
			pk_mng = String.valueOf(((Object[]) res2.get(0))[0]);
			// (String)((ArrayList)res2[0]).getStrFields()[0];
		}
		return pk_mng;

	}

	/**
	 * 增加基本档案根据编码的批取数。 创建日期：(2002-7-31 13:47:11)
	 *
	 * @author：王剑
	 * @return String[]
	 */
	private String[][] getCustSuppPks(String basTable, String mngTable, String basPkField, String mngPkField, String codeFiled, String[] valueCodes, String pk_corp, boolean blnCustomer)
			throws Exception {
		// get BasPk From basTable by valuecode and pk_corp
		String sql1 = "select " + basPkField + "," + codeFiled + " from " + basTable + " where " + codeFiled + " in (" + getValuesFromStrArray(valueCodes) + ") and (pk_corp='0001' or pk_corp='"
				+ pk_corp + "') order by pk_corp desc";
		ArrayList res1 = (ArrayList) new PubDAO().queryVOsBySql(null, null, sql1);
		String pk_bas = null;
		String pkbas = null;
		String code = null;
		Hashtable ht = new Hashtable();
		if (res1 != null && res1.size() > 0) {
			for (int i = 0; i < res1.size(); i++) {

				pkbas = String.valueOf(((Object[]) res1.get(i))[0]);
				// (String)((ArrayList)res1[i]).getStrFields()[0];
				code = String.valueOf(((Object[]) res1.get(i))[1]);
				// (String)((ArrayList)res1[i]).getStrFields()[1];
				if (pkbas != null)
					ht.put(pkbas, code);
				if (res1.size() == 1) {
					pk_bas = "'" + String.valueOf(((Object[]) res1.get(i))[0]) + "'";
					// "'"+(String)((ArrayList)res1[i]).getStrFields()[0]+"'";
				} else {
					if (i == 0)

						pk_bas = "'" + String.valueOf(((Object[]) res1.get(i))[0]);
					// "'"+(String)((ArrayList)res1[i]).getStrFields()[0];

					else if (i != res1.size() - 1) {
						pk_bas = pk_bas + "'";
					} else {
						pk_bas = pk_bas + "','" + String.valueOf(((Object[]) res1.get(i))[0]);
					}
				}
			}

		} else {
			return null;
		}

		// get MngPk From nngTable by BasPk and pk_corp
		String sql2 = "select " + mngPkField + "," + basPkField + " from " + mngTable + " where " + basPkField + " in (" + pk_bas + ") and pk_corp='" + pk_corp + "'";
		if (blnCustomer)
			sql2 = sql2 + " and custflag<>'1' and custflag<>'3' "; // 客户
		else
			sql2 = sql2 + " and (custflag='1' or custflag='3') ";// 供应商
		ArrayList res2 = (ArrayList) new PubDAO().queryVOsBySql(null, null, sql2);

		String pk_mng[][] = null;
		if (res2 != null && res2.size() > 0) {

			pk_mng = new String[res2.size()][2];

			for (int i = 0; i < res2.size(); i++) {
				pk_mng[i][0] = String.valueOf(((Object[]) res2.get(i))[0]);
				// (String)((ArrayList)res2[i]).getStrFields()[0];

				pkbas = String.valueOf(((Object[]) res2.get(i))[1]);
				// (String)((ArrayList)res2[i]).getStrFields()[1];

				pk_mng[i][1] = (String) ht.get(pkbas);

			}

		}
		return pk_mng;

	}

	/**
	 * 客户，供应商档案的所有末级 hzm
	 */
//	private String[] getCustSuppsubPks(String basTable, String mngTable, String basPkField, String mngPkField, String codeFiled, String valueCode, String pk_corp, boolean blnCustomer)
//			throws Exception {
//		// get BasPk From basTable by valuecode and pk_corp
//		String sql1 = "select " + basPkField + " from " + basTable + " where " + codeFiled + " like '" + valueCode + "%' and " + codeFiled + "<>'" + valueCode + "' and (pk_corp='0001' or pk_corp='"
//				+ pk_corp + "') order by pk_corp desc";
//		ArrayList res1 = (ArrayList) new PubDAO().queryVOsBySql(null, null, sql1);
//		String pk_bas[] = null;
//
//		if (res1 != null && res1.size() > 0) {
//			pk_bas = new String[res1.size()];
//			for (int i = 0; i < pk_bas.length; i++) {
//				pk_bas[i] = String.valueOf(((Object[]) res1.get(i))[0]);
//				// (String)((ArrayList)res1[i]).getStrFields()[0];
//			}
//
//		} else {
//			return null;
//		}
//		String instr = "(";
//		for (int i = 0; i < pk_bas.length; i++) {
//			instr = instr + "'" + pk_bas[i] + "'";
//			if (i < pk_bas.length - 1)
//				instr = instr + ",";
//		}
//		instr = instr + ")";
//		// get MngPk From nngTable by BasPk and pk_corp
//		String sql2 = "select " + mngPkField + " from " + mngTable + " where " + basPkField + " in " + instr + " and pk_corp='" + pk_corp + "'";
//		if (blnCustomer)
//			sql2 = sql2 + " and custflag<>'1' and custflag<>'3' "; // 客户
//		else
//			sql2 = sql2 + " and (custflag='1' or custflag='3') ";// 供应商
//		ArrayList res2 = (ArrayList) new PubDAO().queryVOsBySql(null, null, sql2);
//		String pk_mng[] = null;
//		if (res2 != null && res2.size() > 0) {
//			pk_mng = new String[res2.size()];
//			for (int i = 0; i < res2.size(); i++) {
//				pk_mng[i] = String.valueOf(((Object[]) res2.get(i))[0]);
//				// (String)((ArrayList)res2[i]).getStrFields()[0];
//			}
//
//		}
//
//		return pk_mng;
//
//	}

	//
	// 给定一个辅助核算组合，包含该组合的所有ID
	// assvos:辅助核算组合
	//
	public ArrayList getGroupAssIDs(AssVO[] assvos) throws GLBusinessException {
		ArrayList aryList = new ArrayList(assvos.length);
		try {

			FreevalueDMO freevalueDMO = new FreevalueDMO();
			for (int i = 0; i < assvos.length; i++) {
				aryList.add(i, freevalueDMO.getIDs(new AssVO[] { assvos[i] }));
			}

		} catch (Exception e) {
			log.error(e);
			throw new GLBusinessException("FreevalueBean::getGroupAssIDs(AssVO[]) Exception!", e);
		}
		return aryList;
	}

	private String getItemPK(String basTable, String mngTable, String basPkField, String mngPkField, String codeFiled, String valueCode, String pk_corp) throws Exception {
		// get BasPk From basTable by valuecode and pk_corp
		String sql1 = "select " + basPkField + " from " + basTable + " where " + codeFiled + "='" + valueCode + "' ";
		ArrayList res1 = (ArrayList) new PubDAO().queryVOsBySql(null, null, sql1);
		String pk_bas = null;

		if (res1 != null && res1.size() > 0) {
			pk_bas = String.valueOf(((Object[]) res1.get(0))[0]);
			// (String)((ArrayList)res1[0]).getStrFields()[0];
		} else {
			return null;
		}

		// get MngPk From nngTable by BasPk and pk_corp
		String sql2 = "select " + mngPkField + " from " + mngTable + " where " + basPkField + "='" + pk_bas + "' ";
		ArrayList res2 = (ArrayList) new PubDAO().queryVOsBySql(null, null, sql2);

		String pk_mng = null;
		if (res2 != null && res2.size() > 0) {
			pk_mng = String.valueOf(((Object[]) res2.get(0))[0]);
			// (String)((ArrayList)res2[0]).getStrFields()[0];
		}
		return pk_mng;

	}

	/**
	 * 增加基本档案根据编码的批取数。 创建日期：(2002-7-31 13:47:11)
	 *
	 * @author：王剑
	 * @return String[]
	 */
	private String[][] getItemPKs(String basTable, String mngTable, String basPkField, String mngPkField, String codeFiled, String[] valueCodes, String pk_corp) throws Exception {
		// get BasPk From basTable by valuecode and pk_corp
		String sql1 = "select " + basPkField + "," + codeFiled + " from " + basTable + " where " + codeFiled + "in (" + valueCodes + ") ";
		ArrayList res1 = (ArrayList) new PubDAO().queryVOsBySql(null, null, sql1);
		String pk_bas = null;

		String pkbas = null;
		String code = null;
		Hashtable ht = new Hashtable();
		if (res1 != null && res1.size() > 0) {
			for (int i = 0; i < res1.size(); i++) {

				pkbas = String.valueOf(((Object[]) res1.get(i))[0]);
				// (String)((ArrayList)res1[i]).getStrFields()[0];
				code = String.valueOf(((Object[]) res1.get(i))[1]);
				// (String)((ArrayList)res1[i]).getStrFields()[1];
				if (pkbas != null)
					ht.put(pkbas, code);

				pk_bas = pk_bas + String.valueOf(((Object[]) res1.get(i))[0]);
				// (String)((ArrayList)res1[i]).getStrFields()[0];
				if (i != res1.size() - 1) {
					pk_bas = pk_bas + ",";
				}
			}

		} else {
			return null;
		}

		if (res1 != null && res1.size() > 0) {
			pk_bas = String.valueOf(((Object[]) res1.get(0))[0]);
		} else {
			return null;
		}
		String sql2 = "select " + mngPkField + "," + basPkField + " from " + mngTable + " where " + basPkField + "in (" + pk_bas + ") ";
		ArrayList res2 = (ArrayList) new PubDAO().queryVOsBySql(null, null, sql2);

		String pk_mng[][] = null;
		if (res2 != null && res2.size() > 0) {

			pk_mng = new String[res2.size()][2];
			for (int i = 0; i < res2.size(); i++) {
				pk_mng[i][0] = String.valueOf(((Object[]) res2.get(i))[0]);
				// (String)((ArrayList)res2[i]).getStrFields()[0];

				pkbas = String.valueOf(((Object[]) res2.get(i))[1]);
				// (String)((ArrayList)res2[i]).getStrFields()[1];

				pk_mng[i][1] = (String) ht.get(pkbas);

			}

		}
		return pk_mng;

	}

//	private String[] getItemsubPKs(String basTable, String mngTable, String basPkField, String mngPkField, String codeFiled, String valueCode, String pk_corp) throws Exception {
//		// get BasPk From basTable by valuecode and pk_corp
//		String sql1 = "select " + basPkField + " from " + basTable + " where " + codeFiled + " like '" + valueCode + "%' ";
//		ArrayList res1 = (ArrayList) new PubDAO().queryVOsBySql(null, null, sql1);
//		String pk_bas[] = null;
//
//		if (res1 != null && res1.size() > 0) {
//			pk_bas = new String[res1.size()];
//			for (int i = 0; i < pk_bas.length; i++) {
//				pk_bas[i] = String.valueOf(((Object[]) res1.get(i))[0]);
//				// (String)((ArrayList)res1[i]).getStrFields()[0];
//			}
//
//		} else {
//			return null;
//		}
//		String instr = "(";
//		for (int i = 0; i < pk_bas.length; i++) {
//			instr = instr + "'" + pk_bas[i] + "'";
//			if (i < pk_bas.length - 1)
//				instr = instr + ",";
//		}
//		instr = instr + ")";
//
//		// get MngPk From nngTable by BasPk and pk_corp
//		String sql2 = "select " + mngPkField + " from " + mngTable + " where " + basPkField + " in " + instr + " ";
//		ArrayList res2 = (ArrayList) new PubDAO().queryVOsBySql(null, null, sql2);
//
//		String pk_mng[] = null;
//		if (res2 != null && res2.size() > 0) {
//			pk_mng = new String[res2.size()];
//			for (int i = 0; i < res2.size(); i++) {
//				pk_mng[i] = String.valueOf(((Object[]) res2.get(i))[0]);
//				// (String)((ArrayList)res2[i]).getStrFields()[0];
//			}
//
//		}
//
//		return pk_mng;
//
//	}

	/**
	 * 根据bdcode获得pk_bdinfo。 创建日期：(01-10-16 15:58:26)
	 *
	 * @return java.lang.String
	 */
	public String getPkBdinfoByCode(String bdcode) throws GLBusinessException {
		String result = null;
		try {
			FreevalueDMO freevalueDMO = new FreevalueDMO();
			result = freevalueDMO.getPkBdinfoByCode(bdcode);
		} catch (Exception e) {
			throw new GLBusinessException(e.getMessage());
		}
		return result;
	}

	/**
	 * 根据bdname获得pk_bdinfo。 创建日期：(01-10-16 15:58:26)
	 *
	 * @return java.lang.String
	 */
	public String getPkBdinfoByName(String bdname) throws GLBusinessException {
		String result = null;
		try {
			FreevalueDMO freevalueDMO = new FreevalueDMO();
			result = freevalueDMO.getPkBdinfoByName(bdname);
		} catch (Exception e) {
			throw new GLBusinessException(e.getMessage());
		}
		return result;

	}

	/**
	 * 此处插入方法说明。 创建日期：(2003-9-22 13:34:37)
	 *
	 * @return java.lang.String
	 * @param assvos
	 *            nc.vo.glcom.ass.AssVO[]
	 * @param pk_corp
	 *            java.lang.String
	 * @param userID
	 *            java.lang.String
	 * @param h
	 *            java.util.Hashtable
	 * @exception java.lang.Exception
	 *                异常说明。
	 * @exception GLBusinessException
	 *                异常说明。
	 */
	public String getPowerIdTable(AssVO[] assvos, String pk_corp, String userID, Hashtable h, String[] pkglorgbooks) throws GLBusinessException {
		try {
			FreevalueDMO freevalueDMO = new FreevalueDMO();
			return freevalueDMO.getPowerIdTable(assvos, pk_corp, userID, h, pkglorgbooks);
		} catch (Exception e) {
			log.error(e);
			throw new GLBusinessException("FreevalueBean::getIDTable(assvos,pk_corp,userID,h) Exception!", e);
		}

	}

	/**
	 * 此处插入方法说明。 创建日期：(2002-7-31 13:47:11)
	 *
	 * @author：魏小炯
	 * @return nc.vo.glcom.ass.AssVO[]
	 * @param vos
	 *            nc.vo.glcom.ass.AssVO[]
	 */
	private AssVO[] getRealAssVO(AssVO[] vos) throws Exception {
		if (vos == null || vos.length == 0)
			return null;
		for (int i = 0; i < vos.length; i++) {
			if (vos[i].getPk_Checkvalue() == null || vos[i].getPk_Checkvalue().trim().equals("") || FreevalueDMO.NULLPARA.equals(vos[i].getPk_Checkvalue())) {
				vos[i].setPk_Checkvalue(FreevalueDMO.NULLPARA);
				vos[i].setCheckvaluecode(null);
				vos[i].setCheckvaluename(null);
			}
		}
		return vos;
	}

	/**
	 * 此处插入方法说明。 创建日期：(2002-8-1 12:18:16)
	 *
	 * @author：魏小炯
	 * @return java.lang.String
	 * @param pk_bdinfo
	 *            java.lang.String
	 */
	private nc.vo.bd.b02.BdinfoVO getRealBdInfo(String pk_bdinfo) throws Exception {
		// nc.vo.bd.b02.BdinfoVO infovo=new nc.vo.bd.b02.BdinfoVO();
		// infovo.setPk_defdef(pk_bdinfo);
		// nc.vo.bd.b02.BdinfoVO []infoVOs=(new
		// nc.bs.bd.b02.BdinfoDMO()).queryByVO(infovo,new Boolean(true));
		// //if(infoVOs!=null&&infoVOs.length>0){
		// //info=infoVOs[0];
		// //}
		// return (infoVOs==null||infoVOs.length==0)?null:infoVOs[0];
		return null;
	}

	private String getSpecialPk(String basTable, String mngTable, String basPkField, String mngPkField, String codeFiled, String valueCode, String pk_corp) throws Exception {
		// get BasPk From basTable by valuecode and pk_corp
		String sql1 = null;

		sql1 = "select " + basPkField + " from " + basTable + " where " + codeFiled + "='" + valueCode + "' and (pk_corp='0001' or pk_corp='" + pk_corp + "') order by pk_corp desc";
		ArrayList res1 = (ArrayList) new PubDAO().queryVOsBySql(null, null, sql1);
		String pk_bas = null;

		if (res1 != null && res1.size() > 0) {
			pk_bas = String.valueOf(((Object[]) res1.get(0))[0]);
			// (String)((ArrayList)res1[0]).getStrFields()[0];
		} else {
			return null;
		}

		// get MngPk From nngTable by BasPk and pk_corp
		String sql2 = "select " + mngPkField + " from " + mngTable + " where " + basPkField + "='" + pk_bas + "' and pk_corp='" + pk_corp + "'";
		ArrayList res2 = (ArrayList) new PubDAO().queryVOsBySql(null, null, sql2);

		String pk_mng = null;
		if (res2 != null && res2.size() > 0) {
			pk_mng = String.valueOf(((Object[]) res2.get(0))[0]);
			// (String)((ArrayList)res2[0]).getStrFields()[0];
		}
		return pk_mng;

	}

	private String getSpecialPk(String basTable, String mngTable, String basPkField, String mngPkField, String codeFiled, String valueCode, String pk_corp, String typename) throws Exception {
		// get BasPk From basTable by valuecode and pk_corp
		String sql1 = null;
		if (!typename.equals("项目辅助核算") && !typename.equals("专项管理档案")) {
			String sql = "SELECT pk_jobtype FROM bd_jobtype WHERE (jobtypename = '" + typename + "' and (pk_corp = '" + pk_corp + "' or pk_corp = '0001') )  order by pk_corp desc";
			// 2006-09-19
			// Modify by zhanglh
			//
			// ArrayList res=(ArrayList)new
			// PubDAO().queryVOsBySql(null,null,sql1);
			ArrayList res = (ArrayList) new PubDAO().queryVOsBySql(null, null, sql);
			// ///----------Modify End---------------------------------------

			if (res == null || res.size() == 0 || res.get(0) == null)
				return null;
			String pk_jobtype = String.valueOf(((Object[]) res.get(0))[0]);
			// (String)((ArrayList)res[0]).getStrFields()[0];

			sql1 = "select " + basPkField + " from " + basTable + " where " + codeFiled + "='" + valueCode + "' and (pk_corp='0001' or pk_corp='" + pk_corp + "')  and pk_jobtype = '" + pk_jobtype
					+ "' order by pk_corp desc";
			// get BasPk From basTable by valuecode and pk_corp
			// sql1="select "+basPkField+","+codeFiled+ " from "+basTable+"
			// where "+codeFiled+" in ("+getValuesFromStrArray(valueCodes)+")
			// and (pk_corp='0001' or pk_corp='"+pk_corp+"') and pk_jobtype = '"
			// + pk_jobtype + "' order by pk_corp desc";
		} else {
			sql1 = "select " + basPkField + " from " + basTable + " where " + codeFiled + "='" + valueCode + "' and (pk_corp='0001' or pk_corp='" + pk_corp + "') order by pk_corp desc";
		}
		ArrayList res1 = (ArrayList) new PubDAO().queryVOsBySql(null, null, sql1);
		String pk_bas = null;

		if (res1 != null && res1.size() > 0) {
			pk_bas = String.valueOf(((Object[]) res1.get(0))[0]);
			// (String)((ArrayList)res1[0]).getStrFields()[0];
		} else {
			return null;
		}

		// get MngPk From nngTable by BasPk and pk_corp
		String sql2 = "select " + mngPkField + " from " + mngTable + " where " + basPkField + "='" + pk_bas + "' and pk_corp='" + pk_corp + "'";
		ArrayList res2 = (ArrayList) new PubDAO().queryVOsBySql(null, null, sql2);

		String pk_mng = null;
		if (res2 != null && res2.size() > 0) {
			pk_mng = String.valueOf(((Object[]) res2.get(0))[0]);
			// (String)((ArrayList)res2[0]).getStrFields()[0];
		}
		return pk_mng;

	}

	/**
	 * 增加基本档案根据编码的批取数。 创建日期：(2002-7-31 13:47:11)
	 *
	 * @author：王剑
	 * @return String[]
	 */
	private String[][] getSpecialPks(String basTable, String mngTable, String basPkField, String mngPkField, String codeFiled, String[] valueCodes, String pk_corp) throws Exception {

		// get BasPk From basTable by valuecode and pk_corp
		String sql1 = "select " + basPkField + "," + codeFiled + " from " + basTable + " where " + codeFiled + " in (" + getValuesFromStrArray(valueCodes) + ") and (pk_corp='0001' or pk_corp='"
				+ pk_corp + "') order by pk_corp desc";
		ArrayList res1 = (ArrayList) new PubDAO().queryVOsBySql(null, null, sql1);
		String pk_bas = null;
		Hashtable ht = new Hashtable();
		String pkbas = null;
		String code = null;
		if (res1 != null && res1.size() > 0) {
			for (int i = 0; i < res1.size(); i++) {
				pkbas = String.valueOf(((Object[]) res1.get(i))[0]);
				// (String)((ArrayList)res1[i]).getStrFields()[0];
				code = String.valueOf(((Object[]) res1.get(i))[1]);
				// (String)((ArrayList)res1[i]).getStrFields()[1];
				if (pkbas != null)
					ht.put(pkbas, code);
				if (pk_bas == null)
					pk_bas = "'" + String.valueOf(((Object[]) res1.get(i))[0]) + "'";
				// (String)((ArrayList)res1[i]).getStrFields()[0]+"'";
				else
					pk_bas = pk_bas + ",'" + String.valueOf(((Object[]) res1.get(i))[0]) + "'";
				// (String)((ArrayList)res1[i]).getStrFields()[0]+"'";

			}

		} else {
			return null;
		}

		// get MngPk From nngTable by BasPk and pk_corp
		String sql2 = "select " + mngPkField + "," + basPkField + " from " + mngTable + " where " + basPkField + " in (" + pk_bas + ") and pk_corp='" + pk_corp + "'";
		ArrayList res2 = (ArrayList) new PubDAO().queryVOsBySql(null, null, sql2);

		String pk_mng[][] = null;
		if (res2 != null && res2.size() > 0) {

			pk_mng = new String[res2.size()][2];
			for (int i = 0; i < res2.size(); i++) {
				pk_mng[i][1] = String.valueOf(((Object[]) res2.get(i))[0]);
				// (String)((ArrayList)res2[i]).getStrFields()[0];

				pkbas = String.valueOf(((Object[]) res2.get(i))[1]);
				// (String)((ArrayList)res2[i]).getStrFields()[1];

				pk_mng[i][0] = (String) ht.get(pkbas);

			}

		}
		return pk_mng;

	}

	private String[][] getSpecialPks(String basTable, String mngTable, String basPkField, String mngPkField, String codeFiled, String[] valueCodes, String pk_corp, String typename) throws Exception {
		String sql1 = null;
		if (!typename.equals("项目管理档案") && !typename.equals("专项管理档案")) {
			String sql = "SELECT pk_jobtype FROM bd_jobtype WHERE (jobtypename = '" + typename + "' and (pk_corp = '" + pk_corp + "' or pk_corp = '0001') )  order by pk_corp desc";
			ArrayList res = (ArrayList) new PubDAO().queryVOsBySql(null, null, sql);
			if (res == null || res.size() == 0 || res.get(0) == null)
				return null;
			String pk_jobtype = String.valueOf(((Object[]) res.get(0))[0]);
			// (String)((ArrayList)res[0]).getStrFields()[0];

			// get BasPk From basTable by valuecode and pk_corp
			sql1 = "select " + basPkField + "," + codeFiled + " from " + basTable + " where " + codeFiled + " in (" + getValuesFromStrArray(valueCodes) + ") and (pk_corp='0001' or pk_corp='"
					+ pk_corp + "')  and pk_jobtype = '" + pk_jobtype + "' order by pk_corp desc";
		} else {
			sql1 = "select " + basPkField + "," + codeFiled + " from " + basTable + " where " + codeFiled + " in (" + getValuesFromStrArray(valueCodes) + ") and (pk_corp='0001' or pk_corp='"
					+ pk_corp + "')  order by pk_corp desc";
		}
		ArrayList res1 = (ArrayList) new PubDAO().queryVOsBySql(null, null, sql1);
		String pk_bas = null;
		Hashtable ht = new Hashtable();
		String pkbas = null;
		String code = null;
		if (res1 != null && res1.size() > 0) {
			for (int i = 0; i < res1.size(); i++) {
				pkbas = String.valueOf(((Object[]) res1.get(i))[0]);
				// (String)((ArrayList)res1[i]).getStrFields()[0];
				code = String.valueOf(((Object[]) res1.get(i))[1]);
				// (String)((ArrayList)res1[i]).getStrFields()[1];
				if (pkbas != null)
					ht.put(pkbas, code);
				if (pk_bas == null)
					pk_bas = "'" + String.valueOf(((Object[]) res1.get(i))[0]) + "'";
				// (String)((ArrayList)res1[i]).getStrFields()[0]+"'";
				else
					pk_bas = pk_bas + ",'" + String.valueOf(((Object[]) res1.get(i))[0]) + "'";
				// (String)((ArrayList)res1[i]).getStrFields()[0]+"'";

			}

		} else {
			return null;
		}

		// get MngPk From nngTable by BasPk and pk_corp
		String sql2 = "select " + mngPkField + "," + basPkField + " from " + mngTable + " where " + basPkField + " in (" + pk_bas + ") and pk_corp='" + pk_corp + "'";
		ArrayList res2 = (ArrayList) new PubDAO().queryVOsBySql(null, null, sql2);

		String pk_mng[][] = null;
		if (res2 != null && res2.size() > 0) {

			pk_mng = new String[res2.size()][2];
			for (int i = 0; i < res2.size(); i++) {
				pk_mng[i][1] = String.valueOf(((Object[]) res2.get(i))[0]);
				// (String)((ArrayList)res2[i]).getStrFields()[0];

				pkbas = String.valueOf(((Object[]) res2.get(i))[1]);
				// (String)((ArrayList)res2[i]).getStrFields()[1];

				pk_mng[i][0] = (String) ht.get(pkbas);

			}

		}
		return pk_mng;

	}

	/**
	 *
	 * 下级辅助项,返回编码相似的辅助项主键 hzm
	 */
	private String[] getSpecialsubPks(String basTable, String mngTable, String basPkField, String mngPkField, String codeFiled, String valueCode, String pk_corp) throws Exception {
		// get BasPk From basTable by valuecode and pk_corp
		String sql1 = "select " + basPkField + " from " + basTable + " where " + codeFiled + " like '" + valueCode + "%' and " + codeFiled + "<>'" + valueCode + "'";
		ArrayList res1 = (ArrayList) new PubDAO().queryVOsBySql(null, null, sql1);
		String pk_bas[] = null;

		if (res1 != null && res1.size() > 0) {
			pk_bas = new String[res1.size()];
			for (int i = 0; i < pk_bas.length; i++) {
				pk_bas[i] = String.valueOf(((Object[]) res1.get(i))[0]);
				// (String)((ArrayList)res1[i]).getStrFields()[0];
			}

		} else {
			return null;
		}
		String instr = "(";
		for (int i = 0; i < pk_bas.length; i++) {
			instr = instr + "'" + pk_bas[i] + "'";
			if (i < pk_bas.length - 1)
				instr = instr + ",";
		}
		instr = instr + ")";

		// get MngPk From nngTable by BasPk and pk_corp
		String sql2 = "select " + mngPkField + " from " + mngTable + " where " + basPkField + " in " + instr + " and pk_corp='" + pk_corp + "'";
		ArrayList res2 = (ArrayList) new PubDAO().queryVOsBySql(null, null, sql2);

		String pk_mng[] = null;
		if (res2 != null && res2.size() > 0) {
			pk_mng = new String[res2.size()];
			for (int i = 0; i < res2.size(); i++) {
				pk_mng[i] = String.valueOf(((Object[]) res2.get(i))[0]);
				// (String)((ArrayList)res2[i]).getStrFields()[0];
			}

		}
		return pk_mng;

	}

	//
	// 给定一个辅助核算组合，包含该组合的所有ID
	// assvos:辅助核算组合
	//
	public ArrayList getTransferAssID(ArrayList aryList) throws GLBusinessException {
		if (aryList == null || aryList.size() == 0)
			return null;

		ArrayList retALst = new ArrayList(aryList.size());

		try {

			FreevalueDMO freevalueDMO = new FreevalueDMO();
			if (freevalueDMO.getDateBaseType() == 0) {
				for (int i = 0; i < aryList.size(); i++) {
					AssVO[] assvos = (AssVO[]) aryList.get(i);
					String[] assids = freevalueDMO.getIDs(assvos);
					retALst.add(i, assids);
				}
			} else {
				for (int i = 0; i < aryList.size(); i++) {
					AssVO[] assvos = (AssVO[]) aryList.get(i);
					String[] assids = freevalueDMO.getTansferID(assvos);
					retALst.add(i, assids);
				}

			}
			return retALst;
		} catch (Exception e) {
			log.error(e);
			throw new GLBusinessException("FreevalueBean::findByPrimaryKey(FreevaluePK) Exception!", e);
		}
	}

	/**
	 * @param pk_bdinfo
	 * @param pk_corp
	 * @param valuecode
	 * @return
	 */
	private String getPkByBdAccessor(String pk_bdinfo, String pk_corp, String valuecode) {
		IBDAccessor accessor = AccessorManager.getAccessor(pk_bdinfo, pk_corp);
		if (accessor == null)
			return null;
		BddataVO datavo = accessor.getDocByCode(valuecode);
		return datavo == null ? null : datavo.getPk();
	}

	/**
	 * @param pk_bdinfo
	 * @param pk_corp
	 * @param pk
	 * @return
	 */
	private String[] getCodeByBDAccessor(String pk_bdinfo, String pk) {

		IBDAccessor accessor = AccessorManager.getAccessor(pk_bdinfo);
		if (accessor == null)
			return null;
		String result[] = new String[2];
		BddataVO datavo = accessor.getDocByBasdocPK(pk);
		if (datavo == null)
			return null;
		result[1] = datavo.getName();
		result[0] = datavo.getCode();
		return result;

	}

	/**
	 *
	 * @param pk_bdinfo
	 * @param pk_corp
	 * @param valuecodes
	 * @return
	 */
	private String[][] getPkByBdAccessor(String pk_bdinfo, String pk_corp, String[] valuecodes) {
		IBDAccessor accessor = AccessorManager.getAccessor(pk_bdinfo, pk_corp);
		if (accessor == null)
			return null;
		ArrayList<String[]> retarr = new ArrayList<String[]>();
		for (int i = 0; i < valuecodes.length; i++) {
			String valuecode = valuecodes[i];
			BddataVO datavo = accessor.getDocByCode(valuecode);
			if (datavo != null) {
				retarr.add(new String[] { datavo.getCode(), datavo.getPk() });
			}
		}
		return retarr.size() > 0 ? retarr.toArray(new String[0][0]) : null;
	}

	/**
	 * 档案编码转pk全部通过BdAccessor
	 * @param pk_bdinfo
	 * @param pk_corp
	 * @param valuecode
	 * @return
	 */
	public String getValuePkByValueCodeNew(String pk_bdinfo, String pk_corp, String valuecode) {
		return getPkByBdAccessor(pk_bdinfo, pk_corp, valuecode);
	}
	/**
	 * @deprecated by shaoguo.wang
	 * 根据valuename获得pk_value。 创建日期：(01-10-16 15:58:26)
	 * @see getValuePkByValueCodeNew
	 * @return java.lang.String
	 */
	public String getValuePkByValueCode(String pk_bdinfo, String pk_corp, String valuecode) throws GLBusinessException {

		BdinfoVO info = null;
		try {

			if (pk_bdinfo.equals("UAP00000000000invass") || pk_bdinfo.equals("UAP00000000000jobass")) {
				String str = getPkByBdAccessor(pk_bdinfo, pk_corp, valuecode);
				return str;
			}

			FreevalueDMO freevalueDMO = new FreevalueDMO();

			GLBdinfoDMO bdinfoDMO = new GLBdinfoDMO();

			Object obj = bdinfoDMO.findByPK(pk_bdinfo);
			if (obj == null)
				return null;
			info = (BdinfoVO) obj;
			if (info != null) {
				String result = null;
				String bdcode = info.getBdcode();
				String tableName = info.getTablename();
				String pkField = info.getTablepkname();
				String codeField = info.getCodefieldname();
				String nameField = info.getNamefieldname();
				String corpField = info.getCorpfieldname();
				String pk_defdef = info.getPk_defdef();
				// //
				// tzj 2002-05-10
				// job
				if (pk_bdinfo.equals("UAP00000000000jobass") || (bdcode != null && bdcode.startsWith("J"))) {// job
					String str = getPkByBdAccessor(pk_bdinfo, pk_corp, valuecode);
					return str;
				}
				// 供应商
				else if (pk_bdinfo.equals("00010000000000000048") || pk_bdinfo.equals("00010000000000000071") || pk_bdinfo.equals("00010000000000000072") || pk_bdinfo.equals("00010000000000000073")) {
					result = freevalueDMO.getValuePkByValue("bd_cubasdoc", "pk_cubasdoc", "custcode", null, "pk_corp", pk_corp, valuecode, pk_defdef);
					return result;

				} else if (pk_bdinfo.equals("00010000000000000003"))// 客商
				{
					return getCustSuppPk("bd_cubasdoc", "bd_cumandoc", "pk_cubasdoc", "pk_cumandoc", "custcode", valuecode, pk_corp, true);
				}
				// 存货
				else if (pk_bdinfo.equals("00010000000000000004") || pk_bdinfo.equals("UAP00000000000invass")) {
					return getSpecialPk("bd_invbasdoc", "bd_invmandoc", "pk_invbasdoc", "pk_invmandoc", "invcode", valuecode, pk_corp);
				}
				// 项目阶段 ,
				else if (pk_bdinfo.equals("00010000000000000025")) {
					return getItemPK("bd_jobphase", "bd_jobobjpha", "pk_jobphase", "pk_jobobjpha", "jobphasecode", valuecode, pk_corp);

				} else if (pk_bdinfo.equals("00010000000000000096") || pk_bdinfo.equals("00010000000000000097")) {
					return getPkByBdAccessor(pk_bdinfo, pk_corp, valuecode);
				}

				// tzj 2002-05-10
				// //

				if (tableName == null || pkField == null || codeField == null || nameField == null)
					throw new GLBusinessException(nc.bs.ml.NCLangResOnserver.getInstance().getStrByID("2002033381", "UPP2002033381-000002")/*
																																			 * @res
																																			 * "BD_INFO表里的信息不全!"
																																			 */);

				if (
				// tableName.equalsIgnoreCase("bd_invcl")
				// ||
				tableName.equalsIgnoreCase("bd_purorg") || tableName.equalsIgnoreCase("bd_jobphase")) // 存货分类,采购组织，jobphase没有公司字段//hzm
				{
					corpField = null;
				}
				if (pk_bdinfo.equals("00010000000000000014")) {
					pkField = "pk_source";
				}
				result = freevalueDMO.getValuePkByValue(tableName, pkField, codeField, null, corpField, pk_corp, valuecode, pk_defdef);// hzm
				// 2002-07-04修改

				return result;

			}
		} catch (Exception e) {
			throw new GLBusinessException(e.getMessage());
		}
		return null;
	}

	/**
	 * @deprecated by shaoguo.wang
	 * 根据valuename获得pk_value。 创建日期：(01-10-16 15:58:26)
	 *
	 * @return java.lang.String
	 */
	public void getValuePkByValueCode(BdinfoVO info, String pk_corp, ArrayList Values, Hashtable Codes) throws GLBusinessException {
		try {

			if (info != null) {
				String result = null;
				String bdcode = info.getBdcode();
				String tableName = info.getTablename();
				String pkField = info.getTablepkname();
				String codeField = info.getCodefieldname();
				String nameField = info.getNamefieldname();
				String corpField = info.getCorpfieldname();
				String pk_defdef = info.getPk_defdef();
				String pk_bdinfo = info.getPk_bdinfo();
				// //
				// tzj 2002-05-10
				// job
				String valuecode = null;
				for (int i = 0; i < Values.size(); i++) {
					valuecode = (String) Values.get(i);
					if (valuecode == null && valuecode.length() == 0)
						continue;
					if (valuecode.indexOf("%") != -1) {
						valuecode = valuecode.substring(0, valuecode.length() - 1);
					}
					if (pk_bdinfo.equals("00010000000000000015") || (bdcode != null && bdcode.startsWith("J"))) { // job
						Codes.put(pk_bdinfo + valuecode, getSpecialPk("bd_jobbasfil", "bd_jobmngfil", "pk_jobbasfil", "pk_jobmngfil", "jobcode", valuecode, pk_corp));
					}
					// 供应商
					else if (pk_bdinfo.equals("00010000000000000048")) {
						Codes.put(pk_bdinfo + valuecode, getCustSuppPk("bd_cubasdoc", "bd_cumandoc", "pk_cubasdoc", "pk_cumandoc", "custcode", valuecode, pk_corp, false));
					} else if (pk_bdinfo.equals("00010000000000000003")) // 客商
					{
						Codes.put(pk_bdinfo + valuecode, getCustSuppPk("bd_cubasdoc", "bd_cumandoc", "pk_cubasdoc", "pk_cumandoc", "custcode", valuecode, pk_corp, true));
					}
					// 存货
					else if (pk_bdinfo.equals("00010000000000000004")) {
						Codes.put(pk_bdinfo + valuecode, getSpecialPk("bd_invbasdoc", "bd_invmandoc", "pk_invbasdoc", "pk_invmandoc", "invcode", valuecode, pk_corp));
					}
					// 项目阶段 ,
					else if (pk_bdinfo.equals("00010000000000000025")) {
						Codes.put(pk_bdinfo + valuecode, getItemPK("bd_jobphase", "bd_jobobjpha", "pk_jobphase", "pk_jobobjpha", "jobphasecode", valuecode, pk_corp));
					}
					// tzj 2002-05-10
					// //

					else if (tableName == null || pkField == null || codeField == null || nameField == null)
						throw new GLBusinessException(nc.bs.ml.NCLangResOnserver.getInstance().getStrByID("2002033381", "UPP2002033381-000002")/*
																																				 * @res
																																				 * "BD_INFO表里的信息不全!"
																																				 */);
					else {
						FreevalueDMO freevalueDMO = new FreevalueDMO();
						if (
						// tableName.equalsIgnoreCase("bd_invcl") ||
						tableName.equalsIgnoreCase("bd_purorg") || tableName.equalsIgnoreCase("bd_jobphase")) // 存货分类,采购组织，jobphase没有公司字段//hzm
						{
							corpField = null;
						}
						result = freevalueDMO.getValuePkByValue(tableName, pkField, codeField, null, corpField, pk_corp, valuecode, pk_defdef);
						// hzm 2002-07-04修改

						Codes.put(pk_bdinfo + valuecode, result);
					}

				}
			}
		} catch (Exception e) {
			throw new GLBusinessException(e.getMessage());
		}
		return;
	}

	/**
	 * 根据valuecode获得pk_value。 创建日期：(01-10-16 15:58:26)
	 *
	 * @return java.lang.String
	 */
	public String getValuePkByValueName(String pk_bdinfo, String pk_corp, String valuename) throws GLBusinessException {
		BdinfoVO info = null;
		try {
			BDInfo bdinfoDMO = new BDInfo();
			BdinfoVO infoVO = new BdinfoVO();
			infoVO.setPk_bdinfo(pk_bdinfo);
			infoVO.setPk_corp(pk_corp);

			Object[] obj = bdinfoDMO.queryByVO(infoVO, new Boolean(true));
			info = obj == null ? null : (BdinfoVO) obj[0];
			// info = bdinfoDMO.findByPrimaryKey(pk_bdinfo);
			// if (info == null){
			// info = getRealBdInfo(pk_bdinfo);
			// nc.vo.bd.b02.BdinfoVO infovo=new nc.vo.bd.b02.BdinfoVO();
			// infovo.setPk_defdef(pk_bdinfo);
			// nc.vo.bd.b02.BdinfoVO []infoVOs=(new
			// nc.bs.bd.b02.BdinfoDMO()).queryByVO(infovo,new Boolean(true));
			// if(infoVOs!=null&&infoVOs.length>0){
			// info=infoVOs[0];
			// }
			// }
			if (info != null) {
				String result = null;
				String tableName = info.getTablename();
				String pkField = info.getTablepkname();
				String codeField = info.getCodefieldname();
				String nameField = info.getNamefieldname();
				String corpField = info.getCorpfieldname();

				if (tableName == null || pkField == null || codeField == null || nameField == null)
					throw new GLBusinessException(nc.bs.ml.NCLangResOnserver.getInstance().getStrByID("2002033381", "UPP2002033381-000002")/*
																																			 * @res
																																			 * "BD_INFO表里的信息不全!"
																																			 */);

				FreevalueDMO freevalueDMO = new FreevalueDMO();
				result = freevalueDMO.getValuePkByValue(tableName, pkField, null, nameField, corpField, pk_corp, valuename);

				return result;

			}

		} catch (Exception e) {
			throw new GLBusinessException(e.getMessage());
		}
		return null;

	}

	/**
	 *@deprecated by shaoguo.wang
	 * 根据valuename获得pk_value。 创建日期：(01-10-16 15:58:26)
	 *
	 * @return java.lang.String
	 */
	public String[][] getValuePksByValueCodes(BdinfoVO info, String pk_corp, String[] valuecodes) throws GLBusinessException {
		// BdinfoVO info = null;
		try {

			if (info != null) {
				String pk_bdinfo = info.getPk_bdinfo();
				String[][] result = null;
				String bdcode = info.getBdcode();
				String tableName = info.getTablename();
				String pkField = info.getTablepkname();
				String codeField = info.getCodefieldname();
				String nameField = info.getNamefieldname();
				String corpField = info.getCorpfieldname();
				String pk_defdef = info.getPk_defdef();
				// //
				// tzj 2002-05-10
				// job
				if (pk_bdinfo.equals("UAP00000000000invass")) {
					// String str= new
					// FreevalueDMO().getInvDocPk(pk_bdinfo,pk_corp,valuecode);
					// return str;

					return getPkByBdAccessor(pk_bdinfo, pk_corp, valuecodes);
				}

				if (pk_bdinfo.equals("UAP00000000000jobass")) {
					// String str= new
					// FreevalueDMO().getInvDocPk(pk_bdinfo,pk_corp,valuecode);
					// return str;

					return getPkByBdAccessor(pk_bdinfo, pk_corp, valuecodes);
				}
				if (pk_bdinfo.equals("00010000000000000015") || (bdcode != null && bdcode.startsWith("J"))) {// job
					// return getSpecialPks("bd_jobbasfil", "bd_jobmngfil",
					// "pk_jobbasfil", "pk_jobmngfil", "jobcode", valuecodes,
					// pk_corp, info.getBdname());
					return getPkByBdAccessor(pk_bdinfo, pk_corp, valuecodes);
				}
				// 客户辅助核算 总帐客户参照从供应商和客商档案改为客户辅助核算后的取数的相应改变。
				else if (pk_bdinfo.equals("00010000000000000048") || pk_bdinfo.equals("00010000000000000071") || pk_bdinfo.equals("00010000000000000072") || pk_bdinfo.equals("00010000000000000073")) {
					FreevalueDMO freevalueDMO = new FreevalueDMO();
					result = freevalueDMO.getValuePksByValues("bd_cubasdoc", "pk_cubasdoc", "custcode", "null", "pk_corp", pk_corp, getValuesFromStrArray(valuecodes), pk_defdef);// wangj
					// 2003-11-12修改

					return result;
					// return
					// getCustSuppPks("bd_cubasdoc","bd_cumandoc","pk_cubasdoc","pk_cumandoc","custcodes",valuecodes,pk_corp,false);
				} else if (pk_bdinfo.equals("00010000000000000003"))// 客商
				{
					return getCustSuppPks("bd_cubasdoc", "bd_cumandoc", "pk_cubasdoc", "pk_cumandoc", "custcode", valuecodes, pk_corp, true);
				}
				// 存货
				else if (pk_bdinfo.equals("00010000000000000004")) {
					return getSpecialPks("bd_invbasdoc", "bd_invmandoc", "pk_invbasdoc", "pk_invmandoc", "invcode", valuecodes, pk_corp);
				}
				// 项目阶段 ,
				else if (pk_bdinfo.equals("00010000000000000025")) {
					return getItemPKs("bd_jobphase", "bd_jobobjpha", "pk_jobphase", "pk_jobobjpha", "jobphasecode", valuecodes, pk_corp);
				}
				// tzj 2002-05-10
				//
				else if (pk_bdinfo.equals("00010000000000000031")) {
					FreevalueDMO freevalueDMO = new FreevalueDMO();
					result = freevalueDMO.getCorpValuePksByValues(tableName, pkField, codeField, null, corpField, pk_corp, getValuesFromStrArray(valuecodes), pk_defdef);// wj
					// 2006-09-19修改
					return result;
				}

				if (tableName == null || pkField == null || codeField == null || nameField == null)
					throw new GLBusinessException(nc.bs.ml.NCLangResOnserver.getInstance().getStrByID("2002033381", "UPP2002033381-000002")/*
																																			 * @res
																																			 * "BD_INFO表里的信息不全!"
																																			 */);

				FreevalueDMO freevalueDMO = new FreevalueDMO();
				if (// tableName.equalsIgnoreCase("bd_invcl")
				// ||
				tableName.equalsIgnoreCase("bd_purorg") || tableName.equalsIgnoreCase("bd_jobphase")) // 存货分类,采购组织，jobphase没有公司字段//hzm
				{
					corpField = null;
				}
				if (pk_bdinfo.equals("00010000000000000014")) {
					pkField = "pk_source";
				}
				result = freevalueDMO.getValuePksByValues(tableName, pkField, codeField, null, corpField, pk_corp, getValuesFromStrArray(valuecodes), pk_defdef);// hzm
				// 2002-07-04修改

				return result;

			}
		} catch (Exception e) {
			throw new GLBusinessException(e.getMessage());
		}
		return null;
	}

	/**
	 * 此处插入方法说明。 创建日期：(2003-8-26 16:34:38)
	 *
	 * @return java.lang.String
	 * @param params
	 *            java.lang.String[]
	 */
	public String getValuesFromStrArray(String[] params) throws GLBusinessException {
		if (params == null || params.length == 0)
			return null;
		if (params.length == 1)
			return "'" + params[0] + "'";
		String result = "'";
		for (int i = 0; i < params.length; i++) {
			if (i != params.length - 1) {
				result = result + params[i] + "','";
			} else {
				result = result + params[i] + "'";
			}
		}
		return result;
	}

	/**
	 * 另一个是给定辅助核算ID,返回辅助核算的组合。
	 *
	 * 创建日期：(2001-9-18)
	 *
	 * @return nc.vo.glcom.ass.AssVO[] 查到的VO对象数组
	 * @param intID
	 *            组合标识ID
	 * @exception GLBusinessException
	 *                异常说明。
	 */
	public AssVO[] queryAll(String intID) throws GLBusinessException {

		AssVO[] freevalues = null;
		try {
			FreevalueDMO freevalueDMO = new FreevalueDMO();
			freevalues = freevalueDMO.queryAll(intID);
		} catch (Exception e) {
			log.error(e);
			throw new GLBusinessException("FreevalueBean::queryAll(String pk_corp) Exception!", e);
		}
		return freevalues;
	}

	/**
	 * 另一个是给定辅助核算ID,返回辅助核算的组合。
	 *
	 * 创建日期：(2001-9-18)
	 *
	 * @return nc.vo.glcom.ass.AssVO[] 查到的VO对象数组
	 * @param intID
	 *            组合标识ID
	 * @exception GLBusinessException
	 *                异常说明。
	 */
	public GlAssVO[] queryAllByIDs(String[] intID, String[] strType) throws GLBusinessException {

		GlAssVO[] freevalues = null;
		try {
			FreevalueDMO freevalueDMO = new FreevalueDMO();
			freevalues = freevalueDMO.queryAllByIDs(intID, strType);
		} catch (Exception e) {
			log.error(e);
			throw new GLBusinessException("FreevalueBean::queryAll(String pk_corp) Exception!", e);
		}
		return freevalues;
	}

	/**
	 * \n创建日期：(2002-11-15 9:53:23) 更新表gl_freevalue中的档案编码和名称
	 */
	public void refreshCodeName(String[] pk_checktypes, String pk_corp) throws GLBusinessException {
		//
		StringBuffer ErrorInfo = new StringBuffer(1000);
		try {
			FreevalueDMO dmo = new FreevalueDMO();
			// AssCodeConstructor constructor = new AssCodeConstructor();
			BDInfo bdBO = new BDInfo();

			String[] checktypes = null;
			if (pk_checktypes == null || pk_checktypes.length == 0)
				checktypes = dmo.getAllChecktypes();
			else
				checktypes = pk_checktypes;
			if (checktypes == null || checktypes.length == 0)
				return;
			Hashtable docHash = new Hashtable();
			for (int i = 0; i < checktypes.length; i++) {
				String strInfoName = "";
				try {
					nc.vo.bd.access.BdinfoVO infovo = BdinfoManager.getBdInfoVO(checktypes[i]);
					strInfoName = infovo.getBdname();
					nc.vo.bd.access.BddataVO[] bdData = bdBO.getBddataByOrgTypeCode(infovo, OrgnizeTypeVO.COMPANY_TYPE, pk_corp);
					if (bdData == null || bdData.length == 0)
						continue;
					dmo.refreshCodeName(checktypes[i], bdData);
					// lipy 拉横表 2008-07-16
					new GlAssDetailImpl().refreshCodeName(checktypes[i], bdData);

				} catch (java.sql.SQLException e) {
					if (e.getErrorCode() == 208)
						ErrorInfo.append(nc.bs.ml.NCLangResOnserver.getInstance().getStrByID("2002033381", "UPP2002033381-000009")/*
																																	 * @res
																																	 * "【"
																																	 */+ strInfoName + nc.bs.ml.NCLangResOnserver.getInstance().getStrByID("2002033381", "UPP2002033381-000010")/*
																																	 * @res
																																	 * "】"
																																	 */
								+ nc.bs.ml.NCLangResOnserver.getInstance().getStrByID("2002033381", "UPP2002033381-000011")/*
																															 * @res "
																															 * 表不存在。\r\n"
																															 */);
					else
						ErrorInfo.append(nc.bs.ml.NCLangResOnserver.getInstance().getStrByID("2002033381", "UPP2002033381-000009")/*
																																	 * @res
																																	 * "【"
																																	 */+ strInfoName + nc.bs.ml.NCLangResOnserver.getInstance().getStrByID("2002033381", "UPP2002033381-000010")/*
																																	 * @res
																																	 * "】"
																																	 */
								+ nc.bs.ml.NCLangResOnserver.getInstance().getStrByID("2002033381", "UPP2002033381-000012")/*
																															 * @res "
																															 * 档案设置错误。\r\n"
																															 */);
				} catch (BusinessException e) {
					ErrorInfo.append(nc.bs.ml.NCLangResOnserver.getInstance().getStrByID("2002033381", "UPP2002033381-000009")/*
																																 * @res
																																 * "【"
																																 */+ strInfoName + nc.bs.ml.NCLangResOnserver.getInstance().getStrByID("2002033381", "UPP2002033381-000010")/*
																																 * @res
																																 * "】"
																																 */
							+ nc.bs.ml.NCLangResOnserver.getInstance().getStrByID("2002033381", "UPP2002033381-000012")/*
																														 * @res "
																														 * 档案设置错误。\r\n"
																														 */);
				}
			}

			if (ErrorInfo.toString().length() != 0) {
				ErrorInfo.append(nc.bs.ml.NCLangResOnserver.getInstance().getStrByID("2002033381", "UPP2002033381-000013")/*
																															 * @res
																															 * "\r\n除此之外的被选数据已刷新！"
																															 */);
				throw new GLBusinessException(ErrorInfo.toString());
			}
		} catch (NamingException err) {
			log.error(err.getMessage(), err);
			throw new GLBusinessException(nc.bs.ml.NCLangResOnserver.getInstance().getStrByID("2002033381", "UPP2002033381-000014")/*
																																	 * @res
																																	 * "更新档案数据出错！"
																																	 */);
		} catch (SystemException e) {
			log.error(e.getMessage(), e);
			throw new GLBusinessException(nc.bs.ml.NCLangResOnserver.getInstance().getStrByID("2002033381", "UPP2002033381-000014")/*
																																	 * @res
																																	 * "更新档案数据出错！"
																																	 */);

		}
	}

	/**
	 * 此处插入方法说明。
	 *
	 * 数据修改后调用接口
	 *
	 * 创建日期：(2004-3-23 19:50:42)
	 *
	 * @param docType
	 *            java.lang.String
	 * @param opType
	 *            int
	 * @param bd_docVO
	 *            java.lang.Object param description: fun_code ----
	 *            档案类型,该值为Funcode,用来标识正在操作的基本档案 opType ----
	 *            操作类型，档案改变的类型，见接口定义的常量。用来与实现器约定参数的含义
	 *
	 * pk1 ---- 第一主键,不同操作类型含义不同 pk2 ---- 第二主键,不同操作类型含义不同
	 * pk1:封存数据的主键,pk2为null无意义,BDOPERATION_SEAL = 1; 档案封存
	 * pk1:停用数据的主键,pk2为null无意义,BDOPERATION_STOP = 2; 档案停用
	 * pk1:被修改数据的主键,pk2为null无意义,BDOPERATION_ALTER = 3; 档案属性被修改
	 * pk1:合并数据主键,pk2为被合并数据主键,BDOPERATION_COMBINE = 4;档案合并
	 * pk1:数据主键,pk2为下级数据主键,BDOPERATION_ADDSUB = 5; 增加该档案下级 pk1:被删除的数据主键； 删除档案
	 * bd_docData ---- 根据需求约定含义,一般为null.档案数据，指参与档案修改的基础数据，如档案VO等。
	 *
	 */
	public void afterOperate(java.lang.String fun_code, int opType, java.lang.String pk1, java.lang.String pk2, java.lang.Object bd_docData) throws nc.vo.pub.BusinessException {

		if (bd_docData == null || !IBDOperateContextObject.class.isInstance(bd_docData))
			return;
		IBDBaseDoc usrvo = ((IBDOperateContextObject) bd_docData).getBaseVO();
		if (usrvo == null)
			return;
		String pk = usrvo.getPk();
		String code = usrvo.getCode();
		String name = usrvo.getName();
		if (pk != null && code != null && name != null) {
			try {
				FreevalueDMO fdmo = new FreevalueDMO();
				fdmo.updagecode(pk, code, name);
				new GlAssDetailImpl().updateCode(null, pk, code);
			} catch (Exception e) {
				// TODO: handle exception
			}
		}

	}

	/**
	 * 此处插入方法说明。
	 *
	 * 基本档案数据修改前调用接口
	 * 存货、客商、项目、收支项目
	 * java.lang.String func_code:客商管理档案10080806，客商基本档案10080804
	 * 		     存货管理档案10081208，存货基本档案10081206
	 * 			 项目管理档案10081406，项目基本档案10081404
	 * 			 收支项目10081810
	 * int opType: 操作类型，档案改变的类型，见接口定义的常量。用来与实现器约定参数的含义
	 * pk1 ---- 第一主键,不同操作类型含义不同 pk2 ---- 第二主键,不同操作类型含义不同
	 * pk1:封存数据的主键,pk2为null无意义,BDOPERATION_SEAL = 1; 档案封存
	 * pk1:停用数据的主键,pk2为null无意义,BDOPERATION_STOP = 2; 档案停用
	 * pk1:被修改数据的主键,pk2为null无意义,BDOPERATION_ALTER = 3; 档案属性被修改
	 * pk1:合并数据主键,pk2为被合并数据主键,BDOPERATION_COMBINE = 4;档案合并
	 * pk1:数据主键,pk2为下级数据主键,BDOPERATION_ADDSUB = 5; 增加该档案下级 pk1:被删除的数据主键；BDOPERATION_DEL = 6删除档案
	 * bd_docData ---- 根据需求约定含义,一般为null.档案数据，指参与档案修改的基础数据，如档案VO等。
	 *
	 */
	public void beforeOperate(java.lang.String fun_code, int opType, java.lang.String pk1, java.lang.String pk2, java.lang.Object bd_docData) throws nc.vo.pub.BusinessException {
		try {
			if (opType == IBDOperate.BDOPERATION_COMBINE || opType == IBDOperate.BDOPERATION_ADDSUB || opType == IBDOperate.BDOPERATION_DEL ) {
				String[] types = null;
				FreevalueDMO fdmo = new FreevalueDMO();
				if (fun_code.equals("10080806") || fun_code.equals("10080804")) {
					types = new String[]{AssAttributeVOGetter.CUMANDOC_KH_FZHS,AssAttributeVOGetter.CUMANDOC_GYS_FZHS,AssAttributeVOGetter.CUMANDOC_KS_FZHS};
				} else if (fun_code.equals("10081208") || fun_code.equals("10081206")) {
					types = new String[]{AssAttributeVOGetter.INVMANDOC};
					if (fun_code.equals("10081208") && InvmandocVO.class.isInstance(bd_docData)) {
						pk1 = ((nc.vo.bd.invdoc.InvmandocVO)bd_docData).getPk_invbasdoc();
					}
				} else if (fun_code.equals("10081406") || fun_code.equals("10081404")) {
					List<String> jobtypes = fdmo.getJobType(null);
					jobtypes.add(AssAttributeVOGetter.JOBMNGFIL);
					types = new String[jobtypes.size()];
					jobtypes.toArray(types);
				} else if (fun_code.equals("10081810")) {
					types = new String[]{"00010000000000000014"};
					pk1 = ((nc.vo.bd.b28.CostsubjVO)bd_docData).getPk_source();
					pk2 = ((nc.vo.bd.b28.CostsubjVO)bd_docData).getPk_corp();
				}
				if (types != null) {
					fdmo.beforeOperate(fun_code, opType, pk1, pk2, bd_docData, types);
				}
			} else if (fun_code.equals("10080806") && opType == IBDOperate.BDOPERATION_ALTER) {
				BDOperateContextObject contextObject = null;
				if (bd_docData != null) {
					contextObject = (nc.bs.bd.pub.BDOperateContextObject) bd_docData;
					CustManVO newManVO = (CustManVO) contextObject.getNewVO();
					CustManVO oldManVO = (CustManVO) contextObject.getOldVO();
					//CumandocVO[] items = (CumandocVO[]) newManVO.getChildrenVO();
					//String oldCustFlag2 = ((CumandocVO) oldManVO.getChildrenVO()[1]).getCustflag();
					//String newCustFlag2 = items[1].getCustflag();
					//modify by yuandm 客商属性修改时，如果改成了客商则不检查
					if ((newManVO.getCustProp() != CustManVO.CUSTOMER_SUPPLIER&&newManVO.getCustProp()!=oldManVO.getCustProp())) {
						// 引用检查
						FreevalueDMO fdmo = new FreevalueDMO();
						String[] types = new String[]{AssAttributeVOGetter.CUMANDOC_KH_FZHS,AssAttributeVOGetter.CUMANDOC_GYS_FZHS,AssAttributeVOGetter.CUMANDOC_KS_FZHS};
						fdmo.beforeOperate(fun_code, opType, pk1, pk2, bd_docData, types);
					}
				}
			} else if (opType == IBDOperate.BDOPERATION_CANCELASSIGN) {
				String[] types = null;
				FreevalueDMO fdmo = new FreevalueDMO();
				if (fun_code.equals("10080804")) {
					types = new String[]{AssAttributeVOGetter.CUMANDOC_KH_FZHS,AssAttributeVOGetter.CUMANDOC_GYS_FZHS,AssAttributeVOGetter.CUMANDOC_KS_FZHS};
				} else if (fun_code.equals("10081206")) {
					pk1 = ((nc.vo.bd.invdoc.InvmandocVO)bd_docData).getPk_invbasdoc();
					types = new String[]{AssAttributeVOGetter.INVMANDOC};
				} else if (fun_code.equals("10081404")) {
					List<String> jobtypes = fdmo.getJobType(null);
					jobtypes.add(AssAttributeVOGetter.JOBMNGFIL);
					types = new String[jobtypes.size()];
					jobtypes.toArray(types);
				} else if (fun_code.equals("10081810")) {
					types = new String[]{"00010000000000000014"};
				}
				
				if (types != null) {
					fdmo.beforeOperate(fun_code, opType, pk1, pk2, bd_docData, types);
				}
			}
			
		} catch (Exception e) {
			throw new BusinessException(e.getMessage());
		}

	}
	//
	// 给定一个辅助核算组合，包含该组合的所有ID
	// assvos:辅助核算组合
	//
	public void deleteUnusedAssid() throws GLBusinessException {

		try {
			// 首先判断是否进行过数据卸载，如果卸载过则不能够删除,待需求确认后再写
			FreevalueDMO freevalueDMO = new FreevalueDMO();
			freevalueDMO.deleteUnusedAssid();

		} catch (Exception e) {
			log.error(e);
			// throw new
			// GLBusinessException("FreevalueBean::getGroupAssIDs(AssVO[])
			// Exception!", e);
		}

	}

	public String[] queryBdBySql(String sql) throws DAOException {
		BaseDAO bd = new BaseDAO();
		String[] sts = (String[]) bd.executeQuery(sql, new ResultSetProcessor() {
			/**
			 * 版本序列
			 */
			private static final long serialVersionUID = 1L;

			public Object handleResultSet(ResultSet rs) throws SQLException {
				Vector<String> def = new Vector<String>();
				while (rs.next()) {
					def.add(rs.getString(1) == null ? "" : rs.getString(1).trim());
				}
				String[] rts = new String[def.size()];
				def.copyInto(rts);
				return rts;
			}
		});
		return sts;
	}

}